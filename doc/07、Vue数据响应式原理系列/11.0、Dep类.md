Dep 类定义在 /src/core/observer/dep.js 文件中，它的代码量不多，主要作用就是之前讲到的『中转站』、『桥梁』的概念。

我们从之前的依赖收集和触发依赖开始讲起，因为这也是 Dep 的作用。

在 get 中收集依赖：

``` javascript
if (Dep.target) {
  dep.depend()
  if (childOb) {
    childOb.dep.depend()
    if (Array.isArray(value)) {
      dependArray(value)
    }
  }
}
```

Dep.target 作为一个全局 Dep 静态属性，它的值就是当前正在被收集的依赖，因为收集依赖的过程是同步执行的，所以某一时刻，有且只有一个依赖被收集。

判断当前有依赖需要被收集，即 Dep.target 为真时，执行 dep.depend()，来看下 depend 函数：

``` javascript
depend () {
  if (Dep.target) {
    Dep.target.addDep(this)
  }
}
```

主要就是执行 Dep.target.addDep，上面说到 Dep.target 就是一个观察者，就是 Watcher 类的实例，那么 addDep 就是 Watcher 的方法，代码如下：

``` javascript
/**
 * Add a dependency to this directive.
 */
addDep (dep: Dep) {
  const id = dep.id
  if (!this.newDepIds.has(id)) {
    this.newDepIds.add(id)
    this.newDeps.push(dep)
    if (!this.depIds.has(id)) {
      dep.addSub(this)
    }
  }
}
```

先不管其他边界条件，主要看最后一段：dep.addSub(this)。

又要回到 Dep 类，看 addSub 函数：

``` javascript
addSub (sub: Watcher) {
  this.subs.push(sub)
}
```

哈哈，绕了一圈，要做的是就是将依赖 push 到 Dep 的 subs 数组中，并且 watcher 也将 dep push 到自己的 newDeps 中，有没有一种添加好友的感觉：我加了你微信好友，你那边通过下，然后告诉我你统一了，咱俩现在是好友了^_^。

Dep 要做的事还有很多，需要处理很多边界条件，后面遇到再详述，但核心就是这些。

### 注意
本文最后编辑于2019/05/13，技术更替飞快，文中部分内容可能已经过时，如有疑问，可在线提issue。